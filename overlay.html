<!DOCTYPE html>
<html style="background-color: transparent;">
<head>
	<meta content="text/html;charset=utf-8" http-equiv="Content-Type">
	<meta content="utf-8" http-equiv="encoding">
	<title>Lemiffe Twitch Overlay</title>
	<style type="text/css">
	    .float-container {
		    display: none;
	    }
		.pog, .taxi {
			position: absolute;
			width: 100%;
			height: 100%;
			display: none;
		}
		.pog img, .taxi img {
			margin: 0;
			position: absolute;
			top: 50%;
			left: 50%;
			-ms-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
		}
	</style>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
</head>
<body style="margin: 0px; background-color: transparent; text-align: center;">
	<script src="floating.js/floating.js"></script>
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.pubnub.com/sdk/javascript/pubnub.4.27.4.min.js"></script>
    <div class="pog"><img src="images/pog.png" /></div>
    <div class="taxi"><img src="images/taxi2.png" /></div>
	<script>

/*
    Dependencies: floating.js (for nalu cans)
    https://animate.style/ for animations
*/

floating({
    content: '<img src="images/nalucan2.png" class="can" />',
    number: 20,
    duration: 15,
});

floating({
    content: '<img src="images/nalucan3.png" class"can" />',
    number: 12,
    duration: 8,
});

floating({
    content: '<img src="images/nalucan.png" class="can" />',
    number: 13,
    direction: "reverse",
    size: [1, 10],
});

function canFestival() {
    $(".float-container").show();
    setTimeout(function () {
        $(".float-container").fadeOut(2000);
    }, 5000);
}

function playSound(prefix, randomSuffix, randomMax) {
    let suffix = "";
    if (randomSuffix) {
        suffix = (Math.floor(Math.random() * randomMax) + 1).toString();
    }
    const audio = new Audio("sounds/" + prefix + suffix + ".wav");
    audio.play();
}

function animateElement(className, animation, time) {
    const item = document.querySelector(className);
    item.style.setProperty("display", "block");
    item.style.setProperty("--animate-duration", time.toString() + "s");
    item.classList.add("animate__animated", "animate__" + animation);
    item.addEventListener("animationend", () => {
        item.style.setProperty("display", "none");
    });
}

const pubnub = new PubNub({
    subscribeKey: "sub-c-eb22fb3e-3185-11eb-9713-12bae088af96",
    uuid: "myUniqueUUID",
});

pubnub.subscribe({
    channels: ["twitch"],
    message: function (m) {
        console.log(m);
    },
    error: function (error) {
        console.log(JSON.stringify(error));
    },
});

pubnub.addListener({
    status: function (statusEvent) {
        if (statusEvent.category === "PNConnectedCategory") {
        }
    },
    message: function (msg) {
        const text = msg && msg.message && msg.message.text;
        switch (text) {
            case "cmd:nalu":
                canFestival();
                playSound("nalu", true, 15);
                break;
            case "cmd:pogchamp":
                animateElement(".pog", "bounceOutLeft", 4);
                playSound("pog", false, 0);
                break;
            case "cmd:taxi":
                animateElement(".taxi", "bounceInLeft", 4);
                const item = document.querySelector(".taxi");
                item.style.setProperty("display", "block");
                item.style.setProperty("--animate-duration", "2s");
                item.classList.add("animate__animated", "animate__bounceInLeft");
                item.addEventListener("animationend", () => {
                    item.classList.add("animate__animated", "animate__bounceOutRight");
                    item.style.setProperty("display", "block");
                    item.addEventListener("animationend", () => {
                        item.classList.remove("animate__animated", "animate__bounceInLeft", "animate__bounceOutRight");
                        item.style.setProperty("display", "none");
                    });
                });
                playSound("taxi", false, 0);
                break;
            default:
                break;
        }
    },
    presence: function (presenceEvent) {},
});

	</script>
</body>
</html> 
